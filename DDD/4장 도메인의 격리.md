
### 서론
---

제시하는 설계 방식은 대부분 책임 주도 설계(responsibility-driven-design)의 원칙을 따른다.
또한 계약에 의한 설계에 크게 의존하고 있기도 함.


> 시스템에서 도메인과 관련이 적은 기능으로부터 도메인 객체를 분리할 필요가 있으며.
> 도메인 개념을 다른 소프트웨어 기술에만 관련된 개념과 혼동하거나, 또는 시스템이라는 하나의 큰 덩어리 안에서 도메인을 전혀 바라보지 못하는 문제를 방지할 수 있다.

>[!Note]
>즉 포인트는 도메인 계층의 분리 아래 계층형 아키텍처는 일반적인 예시.
#### 계층형 아키텍처
---

##### 해운 애플리케이션 예시

```mermaid
graph TD
화면 --> 선택가능도시목록디비조회
선택가능도시목록디비조회 --> 입력유효성검증및해석
입력유효성검증및해석 --> 도시와화물연결
도시와화물연결 --> 변경내역디비반영
```

이중 **일부만 해운 업무와 관련**되어 있음.

소프트웨어 프로그램은 디비연결, 업무로직 수행, 사용자 입력, 네트워크통신등 기능과 관련된 코드양이 많을 수 있음.


OOP 에서는 때때로 UI, DB, 기타 보조적 성격의 코드를 비즈니스 객체 안에 직접 작성하기도함.

>[!important]
>도메인에 관련된 코드가 상당한 양의 도메인과 관련없는 다른 코드를 통해 널리 확산될 경우.
>도메인에 관련된 코드를 확인하고 추론하기 상당히 힘들어짐.
>ex) UI 표면적 변경이 업무로직 변경으로 이어짐, 업무 규칙을 변경하기 위해 UI, DB 연결, 다른 요소들을 추적해야 할 수 있음.


<img width="316" alt="LayerdArchitecture" src="https://github.com/christopher3810/DomainDrivenDesign/assets/61622657/1df391e9-4e83-4f71-8217-2025c3759c15">

출처 : https://fabiofumarola.github.io/nosql/readingMaterial/Evans03.pdf

구체적으로 몇 개의 일반화된 계층이 널리 받아들여지고 있음.

>[!important]
>계층화의 핵심 원칙은 한 계층의 모든 요소는 오직 같은 계층에 존재하는 다른 요소나 계층상 아래에 위치한 요소에만 의존한다는 것.
>위로 거슬러 올라가는 의사소통은 반드시 간접적인 메커니즘을 거쳐야함.
>각 계층에서 프로그램의 특정 측면만 전문적으로 다루는데 그 가치가 있으며 더욱 응집력있는 설계가 가능해짐.

| 계층                      | 설명                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 사용자 인터페이스<br>(또는 표현 계층) | 사용자에게 정보를 보여주고 사용자의 명령을 해석하는 일을 책임진다. <br>이는 사람 뿐만 아니라 다른 컴퓨터 시스템도 외부 행위자가 되기도 함.                                                                                                                                                                                                                                                                                                                                                 |
| 응용 계층                   | 소프트웨어가 <font color="#00ffcc">수행할 작업을 정의</font>하며, <font color="#00ffcc">표현력 있는 도메인 객체가 문제를 해결</font>하도록 함.<br>이 계층은 업무상 중요하거나 다른 시스템과의 상호작용을 필요로 하는 것들.<br>이 계층은 <font color="#00ffcc">얇게 유지</font>된다 여기에 업<font color="#00ffcc">무 규칙이나 지식은 포함하지 않으며, 오직 작업을 조정하고 아래에 위치한 계층에 포함된 도메인 객체의 협력자에게 작업을 위임 </font>한다.<br>응용 계층에는 **업무 상황을 반영하는 상태가 없지만**, <br>사용자나 프로그램의 작업에 대한 <font color="#00ffcc">진행상황을 반영하는 상태를 가질 수는 있다</font>. |
| 도메인 계층                  | 업무 <font color="#00ffcc">개념과 업무 상황에 관한 정보, 업무 규칙을 표현하는 일을 책임</font>집니다. <br>이 계층은 <font color="#00ffcc">업무 상황을 반영하는 상태를 제어하고 사용</font>하며, <font color="#00ffcc">상태 저장과 관련된 기술적 세부사항은 인프라스트럭처 계층에 위임</font>합니다. <br>업무용 소프트웨어의 핵심.                                                                                                                                                                                                                              |
| 인프라스트럭처 계층              | 상위 계층을 지원하는 일반화된 기술적 기능을 제공합니다. <br>이러한 기능에는 애플리케이션에 대한 메시지 전송, 도메인 영속화, 비주얼 위젯 그리기 등이 포함됩니다. <br>또한 인프라스트럭처 계층은 아키텍처 프레임워크를 통해 네 가지 계층 간의 상호작용 패턴을 지원할 수 있습니다.                                                                                                                                                                                                                                                                   |

1. 복잡한 프로그램을 여러개의 계층으로 나눌것
2. 아래에 위치한 계층에만 의존하는 각 계층에서 설계를 발전
3. 상위 계층과 결합도를 느슨하게 유지.
4. 도메인 모델과 관련 된 코드는 한 계층에 모으고 나머지는 격리.

>[!important]
>MDD를 가능하게 하는 것은 결정적으로 도메인 계층을 분리하는 것에 있다.
>도메인 모델을 표현하는 것에만 집중 할 수 있으며 모델은 변경되는 과정을 통해 풍부하고 명확해짐.

#### 이점 두가지

> 1. 격리된 각 계층이 각자 다른 속도로 발전해서 각기 다른 요구에 대처하기 때문에 유지 비용이 적어짐
> 왜 그럴까? 🤔 (α)

   ex) 도메인 계층에는 KYC 핵심 비즈니스 로직과 규칙이 포함되어 있어 안정성과 일관성을 유지해야 할 필요가 있음. 
   반면 사용자 인터페이스는 UI를 개선하거나 새로운 사용자 요구사항을 적용하기 위해 자주 업데이트가 필요할 수 있음.
   인프라 계층은 쿼리 튜닝, 데이터 베이스 테이블 변경, indexing or NoSQL DB 활용을 고려할 수 있음.
   
계층을 분리함으로써, 한 계층에서 변경이 일어날 때 다른 계층에 변경을 요구하지 않아도 되므로 의존성을 줄이고 유지 보수 및 테스트를 간소화할 수 있음.

>2. 분산된 시스템에 배포할 때도 이러한 분리가 도움되는데, 통신상의 부하를 최소화하고 성능을 개선하고자 각기 다른 서버나 클라이언트에 각 계층을 유연하게 둘수 있기 때문이다. 왜 그럴까? 🤔 (α)

1. **통신 최적화**: 각 계층이 최적의 위치에 배치 되어 필요한 리소스에 빠르게 접근할 수 있음. 
   이는 네트워크 latency 를 줄이고, 데이터 처리 속도를 향상시킬 수 있음.
   ex) 사용자 인터페이스 쪽은 image 관련해서 s3 & cloudfront를 활용해서 네트워크 latency를 줄일 수 있음.
2. **부하 분산**: 각 계층이 별도의 서버에서 운영되므로, 한 계층에서 발생하는 부하가 다른 계층으로 전파되지 않을 수 있음. 
   이는 시스템 전체의 안정성과 응답성을 향상시킴.
   ex) 그걸 넘어서 서킷 & 쿠버 오토스케일링 
3. **자원 효율성 증가**: 서버와 서비스를 계층에 따라 적절히 할당함으로써 자원 사용을 최적화하고, 필요에 따라 독립적으로 확장 또는 축소할 수 있음.
    ex) ec2를 예시로 들면 계산 집약적인 응용 계층(Spring Boot 애플리케이션)은 CPU 성능이 뛰어난 C5 인스턴스에 배치하고, I/O가 많은 데이터베이스 계층은 I/O 최적화된 R5 인스턴스에 배치

>[!warning]
>분산 시스템을 기존에 사용하고 있는 경우에 대한 통신 상의 부하 감소 등의 성능적 이점임.
>기존 서비스가 트래픽이 적거나 실제로 분산서비스로 활용될 인프라 비용대비 실제 사용될 서비스 규모가 작은 경우 분산서비스는 통신비용 증가로 이어 질 수 있음 이부분은 모놀리식 시스템과 분산 시스템의 구조적 변경에 시점에 대한 문제이고 위 부분은 분산 시스템을 잘 가용하고 있다는 전제 하에 장점임. (α)



